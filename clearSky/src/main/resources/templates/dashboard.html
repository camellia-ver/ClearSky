<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClearSky 대시보드</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="/css/dashboard.css">
    <link rel="stylesheet" href="/css/common.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script th:src="@{/js/forecast-chart.js}"></script>
</head>
<body>

<!-- 헤더 -->
<header class="mb-4">
    <div th:replace="~{fragments/navbar :: nav}"></div>
</header>

<div class="container pt-3 pb-3">
    <h2 class="mb-4">
        <i class="bi bi-geo-alt-fill text-primary"></i>
        <span th:text="${currentLocation} + ' 현재 실황'">서울 현재 실황</span>
    </h2>

    <!-- 상단 요약 카드 영역 -->
    <div class="row g-3 mb-4">
        <!-- 현재 기온 -->
        <div class="col-md-4 col-sm-6">
            <div class="card h-100 shadow-sm border-0 rounded-3">
                <div class="card-body d-flex flex-column align-items-center text-center">
                    <i class="bi bi-thermometer-half fs-1 text-danger mb-2"></i>
                    <h6 class="text-muted">현재 기온</h6>
                    <h4 class="fw-bold" th:text="${weatherData.temperature != null ? #numbers.formatDecimal(weatherData.temperature,1,1) + '°C' : '-'}">-</h4>
                </div>
            </div>
        </div>

        <!-- 습도 -->
        <div class="col-md-4 col-sm-6">
            <div class="card h-100 shadow-sm border-0 rounded-3">
                <div class="card-body d-flex flex-column align-items-center text-center">
                    <i class="bi bi-droplet-fill fs-1 text-info mb-2"></i>
                    <h6 class="text-muted">습도</h6>
                    <h4 class="fw-bold" th:text="${weatherData.humidity != null ? weatherData.humidity + '%' : '-'}">-</h4>
                </div>
            </div>
        </div>

        <!-- 풍향 -->
        <div class="col-md-4 col-sm-6">
            <div class="card h-100 shadow-sm border-0 rounded-3">
                <div class="card-body d-flex flex-column align-items-center text-center">
                    <i class="bi bi-compass-fill fs-1 text-primary mb-2"></i>
                    <h6 class="text-muted">풍향</h6>
                    <span class="badge bg-primary p-2" th:text="${weatherData.calculatedWindDirectionString != null ? weatherData.calculatedWindDirectionString : '-'}">-</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 중간 시각화 영역 -->
    <div class="card shadow-sm border-0 rounded-3 mb-4">
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
            <span class="fw-bold">시간대별 날씨 그래프 📈</span>
        </div>
        <div class="card-body">
            <div style="height: 500px;">
                <canvas id="forecastChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script th:inline="javascript">
    // 컨트롤러에서 전달받은 Java List<WeatherDisplayDto>를 JavaScript 변수로 변환
    const chartRawData = [[${forecastDataList}]];

    // 변환된 데이터와 캔버스 ID를 인수로 함수 호출
    if (chartRawData && chartRawData.length > 0) {
        initializeForecastChart(chartRawData, 'forecastChart');
    } else {
        console.error("그래프를 그릴 데이터가 없습니다.");
    }
</script>
</body>
</html>
